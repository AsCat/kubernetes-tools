#!/bin/bash

# Kubernetes Tools - Copyright (C) 2017 Shawn Wang
# https://github.com/shawnxlw/kubernetes-tools
#
# You may use, distribute or modify this software under the terms of the MIT license.


describe_pod() {
  PS3="Please select a pod:"
  
  OLD_IFS="$IFS"
  IFS=$'\n'
  pods=($(/bin/sh -c "kubectl get pod $1"|awk '{print $1}'|sed '1d'))
  IFS="$OLD_IFS"
  
  select pod in "${pods[@]}"
  do 
    /bin/sh -c "kubectl describe pod $pod $1"
    break
  done
  exit 0
}

# sohw help
show_help() {
  echo -e "Kubernetes Tools - kds"
  echo -e "- Describe selected pod of default namespace: kds"
  echo -e "- Describe selected pod of specified [namespace]: kds [namespace]\n"
}

show_help
# parse arguments
while [ "$1" != "" ]; do
  case $1 in
    -n | --namespace ) shift
      describe_pod "-n $1"
      ;;
    -h | --help ) shift
      exit 0
      ;;
    * ) describe_pod "-n $1"
  esac
  shift
done

# describe pod in current namespace if no argument specified
describe_pod